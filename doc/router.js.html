<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: core/router.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: core/router.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview app.core.Router uses goog.History and hash tokens to hold and manage the state of the application.
 * This class is modified mvc.Router class from PlastronJS library.
 * @see https://github.com/rhysbrettbowen/PlastronJS#mvcrouter
 * @author Rhys Brett-Bowen&lt;rhysbrettbowen@gmail.com>, Dmitry Antonenko&lt;dmitry.antonenko@pubwebkit.com>
 */

goog.provide('app.core.Router');

goog.require('goog.History');
goog.require('goog.array');
goog.require('goog.events');
goog.require('goog.history.Html5History');


/**
 * @constructor
 * @extends {goog.events.EventTarget}
 *
 * @param {boolean=} opt_noFragment set to true to hide fragment when using
 * HTML5 history.
 * @param {string=} opt_blankPage url to a blank page - needed if HTML5 is not
 * available and you don't want to show the fragment.
 * @param {HTMLInputElement=} opt_input The hidden input element to be used to
 * store the history token.  If not provided, a hidden input element will
 * be created using document.write.
 * @param {HTMLIFrameElement=} opt_iframe The hidden iframe that will be used by
 * IE for pushing history state changes, or by all browsers if opt_noFragment
 * is true. If not provided, a hidden iframe element will be created using
 * document.write.
 */
app.core.Router = function(opt_noFragment, opt_blankPage, opt_input, opt_iframe) {
    goog.base(this);
    this.history_ = goog.history.Html5History.isSupported() ?
        new goog.history.Html5History() :
        new goog.History(!!(opt_blankPage &amp;&amp; opt_noFragment), opt_blankPage, opt_input, opt_iframe);
    if (this.history_.setUseFragment)
        this.history_.setUseFragment(!opt_noFragment);
    goog.events.listen(this.history_, goog.history.EventType.NAVIGATE, this.onChange_, false, this);
    this.routes_ = [];
    this.currentFragment_ = "";
    this.history_.setEnabled(true);
};
goog.inherits(app.core.Router, goog.events.EventTarget);


/**
 * Router event types
 * @enum {string}
 */
app.core.Router.EventType = {
    /*
     * event to trigger when route is about to change.
     */
    ROUTE_EXPIRED: "routeExpired"
};


/**
 * Pass through the fragment for the URL
 * @param {string} fragment to set for the history token.
 */
app.core.Router.prototype.navigate = function(fragment) {
    this.history_.setToken(fragment);
};


/**
 * Returns current routed fragment
 * @return {string} routed fragment.
 */
app.core.Router.prototype.getFragment = function() {
    return this.currentFragment_;
};


/**
 * Define route as string or regex. /:abc/ will pass "abc" through as an
 * argument. *abc/def will pass through all after the * as an argument
 *
 * @param {string|RegExp} route to watch for.
 * @param {function(string, ...[string])} fn should take in the token and any captured strings.
 * @param {Object=} opt_context Object in whose context the function is to be
 *     called (the global scope if none).
 */
app.core.Router.prototype.route = function(route, fn, opt_context) {
    if (goog.isString(route))
        route = new RegExp('^' + goog.string.regExpEscape(route)
            .replace(/\\:\w+/g, '([a-zA-Z0-9._-]+)')
            .replace(/\\\*/g, '(.*)')
            .replace(/\\\[/g, '(')
            .replace(/\\\]/g, ')?')
            .replace(/\\\{/g, '(?:')
            .replace(/\\\}/g, ')?') + '$');
    var completeRoute = {
        route: route,
        callback: fn,
        context: opt_context
    };

    this.routes_.push(completeRoute);
};


/**
 * Run route callback if route regexp matches fragment.
 * @param {Object} route Route object with context and route regexp.
 * @param {string} fragment URI fragment to match with.
 */
app.core.Router.prototype.runRouteIfMatches_ = function(route, fragment) {
    var args = route.route.exec(fragment);
    if (args) {
        route.callback.apply(route.context, args);
        return true;
    }
    return false;
};


/**
 * Route change handler.
 * @private
 */
app.core.Router.prototype.onChange_ = function() {
    var fragment = this.history_.getToken();
    var locationPathname = window.location.pathname;

    if(goog.string.isEmptyOrWhitespace(fragment) &amp;&amp; locationPathname.length > 1) {
        fragment = locationPathname;
    }

    if (fragment != this.currentFragment_) {
        this.dispatchEvent({
            type: app.core.Router.EventType.ROUTE_EXPIRED,
            previous: this.currentFragment_,
            current: fragment
        });
        this.currentFragment_ = fragment;
        goog.array.find(this.routes_ || [], function(route) {
            return this.runRouteIfMatches_(route, fragment);
        }, this);
    }
};


/**
 * Go through all defined routes and run first matched.
 */
app.core.Router.prototype.checkRoutes = function() {
    var fragment = this.history_.getToken();
    var locationPathname = window.location.pathname;

    if(goog.string.isEmptyOrWhitespace(fragment) &amp;&amp; locationPathname.length > 1) {
        fragment = locationPathname;
    }

    this.currentFragment_ = fragment;
    goog.array.find(this.routes_ || [], function(route) {
        return this.runRouteIfMatches_(route, fragment);
    }, this);
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="app.controllers.HomeController.html">HomeController</a></li><li><a href="app.Core.html">Core</a></li><li><a href="app.core.Application.html">Application</a></li><li><a href="app.core.Application_processRoute_-instance.html">instance</a></li><li><a href="app.core.Controller.html">Controller</a></li><li><a href="app.core.events.ActionEvent.html">ActionEvent</a></li><li><a href="app.core.events.ActionExceptionEvent.html">ActionExceptionEvent</a></li><li><a href="app.core.Request.html">Request</a></li><li><a href="app.core.Response.html">Response</a></li><li><a href="app.core.Router.html">Router</a></li><li><a href="app.core.types.ActionFilterContext.html">ActionFilterContext</a></li><li><a href="app.core.types.ActionFilterItem.html">ActionFilterItem</a></li><li><a href="app.core.types.ApplicationFilterItem.html">ApplicationFilterItem</a></li><li><a href="pwk.BranchNode.html">BranchNode</a></li><li><a href="pwk.Document.html">Document</a></li><li><a href="pwk.Document.NodeRemovedEvent.html">NodeRemovedEvent</a></li><li><a href="pwk.DocumentSettings.html">DocumentSettings</a></li><li><a href="pwk.Editor.html">Editor</a></li><li><a href="pwk.EditorContainer.html">EditorContainer</a></li><li><a href="pwk.layer.Caret.html">Caret</a></li><li><a href="pwk.layer.Caret.AfterUpdateEvent.html">AfterUpdateEvent</a></li><li><a href="pwk.layer.SelectionOverlay.html">SelectionOverlay</a></li><li><a href="pwk.LeafNode.html">LeafNode</a></li><li><a href="pwk.LeafNode.NodeContentChangedEvent.html">NodeContentChangedEvent</a></li><li><a href="pwk.Line.html">Line</a></li><li><a href="pwk.LineContent.html">LineContent</a></li><li><a href="pwk.Node.html">Node</a></li><li><a href="pwk.NodeAnnotation.html">NodeAnnotation</a></li><li><a href="pwk.NodeAttribute.html">NodeAttribute</a></li><li><a href="pwk.Page.html">Page</a></li><li><a href="pwk.Page.PageOverflowEvent.html">PageOverflowEvent</a></li><li><a href="pwk.PageContent.html">PageContent</a></li><li><a href="pwk.PageFooter.html">PageFooter</a></li><li><a href="pwk.PageHeader.html">PageHeader</a></li><li><a href="pwk.PageSettings.html">PageSettings</a></li><li><a href="pwk.Pagination.html">Pagination</a></li><li><a href="pwk.primitives.ClientRectRange.html">ClientRectRange</a></li><li><a href="pwk.primitives.NodeSelectionRange.html">NodeSelectionRange</a></li><li><a href="pwk.Range.html">Range</a></li><li><a href="pwk.Ruler.html">Ruler</a></li><li><a href="pwk.Selection.html">Selection</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> on Tue Dec 30 2014 02:19:31 GMT+0200 (EET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
